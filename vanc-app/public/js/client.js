"use strict";var App=App||{},google=google;App.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),this.$modalContent=$(".modal-content"),$(".logout").on("click",this.logout.bind(this)),this.$modalContent.on("submit","form",this.handleForm),this.$modalContent.on("click",".go",this.getRestaurants),this.getToken()?this.loggedInState():this.loggedOutState()},App.addInfoWindowForRestaurant=function(o,t){var e=this;google.maps.event.addListener(t,"click",function(){"undefined"!=typeof e.infoWindow&&e.infoWindow.close(),e.infoWindow=new google.maps.InfoWindow({content:"<img"+o.restaurant.featured_image+"><p>"+o.restaurant.name+"</p><p>"+o.restaurant.location.address+"</p><p>"+o.restaurant.location.cuisines+"</p>"}),e.infoWindow.open(e.map,t)})},App.createMarkerForRestaurant=function(o){var t="http://icons.iconarchive.com/icons/icons-land/vista-map-markers/32/Map-Marker-Marker-Outside-Pink-icon.png",e=new google.maps.LatLng(o.restaurant.location.latitude,o.restaurant.location.longitude),n=new google.maps.Marker({position:e,map:this.map,icon:t,animation:google.maps.Animation.DROP});this.addInfoWindowForRestaurant(o,n)},App.loopThroughRestaurants=function(o){$.each(o.restaurants,function(o,t){setTimeout(function(){App.createMarkerForRestaurant(t)},50*o)})},App.getRestaurants=function(){$(".modal").modal("hide"),$("#map-canvas").show();var o=$(".neighbourhood").val(),t=$(".category").val();$.get({url:"https://developers.zomato.com/api/v2.1/search?entity_id="+o+"&entity_type=subzone&q=Yaletown&count=15&lat=49.2755687553&lon=-123.1212622066&radius=700&category="+t+"&sort=rating&order=desc",headers:{"user-key":"a076d160e3eff25d9c8448aa2c2dc85b"}}).done(App.loopThroughRestaurants)},App.mapSetup=function(){$(".modal").modal("hide"),$("#map-canvas").show();var o=document.getElementById("map-canvas"),t={zoom:14,center:new google.maps.LatLng(49.2824303,(-123.126847)),mapTypeId:google.maps.MapTypeId.ROADMAP};this.map=new google.maps.Map(o,t)},App.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.$modalContent.addClass("questions"),this.$modalContent.html('\n    <div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <h4 class="modal-title">Let\'s begin</h4>\n    </div>\n    <div class="modal-body">\n    <p>Where are you?</p>\n    <select class="neighbourhood custom-select mb-2 mr-sm-2 mb-sm-0" id="inlineFormCustomSelect">\n    <option selected>Neighbourhood...</option>\n    <option value="98130">Yaletown</option>\n    <option value="98137">Gastown</option>\n    <option value="98135">Downtown</option>\n    <option value="98139">Kitsilano</option>\n    <option value="98129">Main Street</option>\n    </select>\n    <p>What meal are you looking for?</p>\n    <select class="category custom-select mb-2 mr-sm-2 mb-sm-0" id="inlineFormCustomSelect">\n    <option selected>Meal...</option>\n    <option value="8">Breakfast</option>\n    <option value="9">Lunch</option>\n    <option value="2">Supper</option>\n    </select>\n    <button type="submit" class="go btn btn-primary">Go</button>\n    </div>\n    '),$(".modal").modal("show")},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.mapSetup(),this.$modalContent.addClass("welcome"),this.$modalContent.html('\n    <div class="modal-header">\n    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n    <h3 class="modal-title">Welcome to VancApp!</h3>\n    </div>\n    <div class="modal-body">\n    <h4>Feeling hungry but not sure where to go?</h4>\n    <h6>Well you\'re in luck, because Vancouver is <span>the best city for food</span> and we\'ve got you covered! Just tell us what neighbourhood you\'re in and what kind of meal you\'re looking for and we\'ll work some magic to let you know where\'s tasty nearby...</h6>\n    <p>But first of all, please register or login below:</p>\n    <button type="button" name="button" class="register">Register</button>\n    <button type="button" name="button" class="login">Log In</button>\n    </div>'),$(".modal").modal("show"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this))},App.register=function(o){o&&o.preventDefault(),this.$modalContent.html('\n    <form method="post" action="/register">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        <h4 class="modal-title">Register</h4>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n          <input class="form-control" type="text" name="user[username]" placeholder="Username">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="email" name="user[email]" placeholder="Email">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[password]" placeholder="Password">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n        </div>\n        <input class="btn btn-primary" type="submit" value="Register">\n      </div>\n    </form>'),$(".modal").modal("show")},App.login=function(o){o.preventDefault(),this.$modalContent.html('\n    <form method="post" action="/login">\n    <div class="modal-header">\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n      <h4 class="modal-title">Login</h4>\n    </div>\n    <div class="modal-body">\n      <div class="form-group">\n      <input class="form-control" type="email" name="email" placeholder="Email">\n    </div>\n    <div class="form-group">\n      <input class="form-control" type="password" name="password" placeholder="Password">\n    </div>\n    <input class="btn btn-primary" type="submit" value="Login">\n  </form>'),$(".modal").modal("show")},App.logout=function(o){o.preventDefault(),this.removeToken(),this.loggedOutState()},App.handleForm=function(o){o.preventDefault(),$(".modal").modal("hide");var t=""+App.apiUrl+$(this).attr("action"),e=$(this).attr("method"),n=$(this).serialize();return App.ajaxRequest(t,e,n,function(o){o.token&&App.setToken(o.token),App.loggedInState()})},App.ajaxRequest=function(o,t,e,n){return $.ajax({url:o,method:t,data:e,beforeSend:this.setRequestHeader.bind(this)}).done(n).fail(function(o){console.log(o)})},App.setRequestHeader=function(o){return o.setRequestHeader("Authorization","Bearer "+this.getToken())},App.setToken=function(o){return window.localStorage.setItem("token",o)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},$(App.init.bind(App));