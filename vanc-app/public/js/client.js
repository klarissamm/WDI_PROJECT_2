"use strict";var App=App||{},google=google;App.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),this.$modalContent=$(".modal-content"),this.$sidebar=$(".sidebar"),this.$recommended=$(".recommended"),this.$fullImage=$(".full-image"),$(".logout").on("click",this.logout.bind(this)),$(".featured").on("click",this.featuredRestaurant),$(".burger-menu").on("click",this.showSidebar),this.$modalContent.on("submit","form",this.handleForm),this.$sidebar.on("click",".go",this.getRestaurants),this.$sidebar.on("click",".close",this.closeSidebar),this.$main.on("click",".add",this.addChoiceToSidebar),this.$recommended.on("click",".close",this.closeFeatures),this.getToken()?this.loggedInState():this.loggedOutState(),this.mapSetup()},App.addChoiceToSidebar=function(e){e.setMap(null)},App.addInfoWindowForRestaurant=function(e,t){var o=this;google.maps.event.addListener(t,"click",function(){console.log(e.restaurant),"undefined"!=typeof o.infoWindow&&o.infoWindow.close(),o.infoWindow=new google.maps.InfoWindow({content:"<div class='infoWindow'><img src="+e.restaurant.featured_image+"><p>"+e.restaurant.name+"</p><p>"+e.restaurant.location.address+"</p><p>"+e.restaurant.cuisines+"</p>\n      <button class='add' type='button' value='"+e.restaurant.name+"' name='button'>Add</button></div>"}),o.infoWindow.open(o.map,t)})},App.createMarkerForRestaurant=function(e){var t="../images/icon6.png",o=new google.maps.LatLng(e.restaurant.location.latitude,e.restaurant.location.longitude),n=new google.maps.Marker({position:o,map:this.map,icon:t,animation:google.maps.Animation.DROP});this.addInfoWindowForRestaurant(e,n)},App.loopThroughRestaurants=function(e){$.each(e.restaurants,function(e,t){setTimeout(function(){App.createMarkerForRestaurant(t)},100*e)})},App.getRestaurants=function(){var e={98130:"Yaletown",98137:"Gastown",98135:"Downtown",98139:"Kitsilano",98129:"Main Street"},t=$(".neighbourhood").val(),o=e[t],n=$(".category").val();$.get({url:"https://developers.zomato.com/api/v2.1/search?entity_id="+t+"&entity_type=subzone&q="+o+"&count=15&radius=700&category="+n+"&sort=rating&order=desc",headers:{"user-key":"a076d160e3eff25d9c8448aa2c2dc85b"}}).done(App.loopThroughRestaurants)},App.mapSetup=function(){var e=document.getElementById("map-canvas"),t={zoom:13,center:new google.maps.LatLng(49.2824303,(-123.126847)),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"water",elementType:"geometry.fill",stylers:[{saturation:"-100"},{lightness:"-100"},{gamma:"0.00"}]}]};this.map=new google.maps.Map(e,t)},App.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),$(".recommended").hide(),this.showSidebar()},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),$(".sidebar").hide(),$(".recommended").hide(),this.mapSetup(),this.$modalContent.addClass("welcome"),this.$modalContent.html("\n    <div class='modal-header'>\n    <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>\n    <h3 class='modal-title'>Feeling hungry?</h3>\n    </div>\n    <div class='modal-body'>\n    <h6>Well you're in luck, because Vancouver is <span>the best city for food</span> and we've got you covered! Just tell us what neighbourhood you're in and what kind of meal you're looking for and we'll work some magic to let you know where's tasty nearby...</h6>\n    <p>But first of all, please register or login below:</p>\n    <button type='button' name='button' class='register'>Register</button>\n    <button type='button' name='button' class='login'>Log In</button>\n    </div>"),$(".modal").modal("show"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this))},App.register=function(e){e&&e.preventDefault(),this.$modalContent.html("\n    <form method='post' action='/register'>\n      <div class='modal-header'>\n        <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>\n        <h4 class='modal-title'>Register</h4>\n      </div>\n      <div class='modal-body'>\n        <div class='form-group'>\n          <input class='form-control' type='text' name='user[username]' placeholder='Username'>\n        </div>\n        <div class='form-group'>\n          <input class='form-control' type='email' name='user[email]' placeholder='Email'>\n        </div>\n        <div class='form-group'>\n          <input class='form-control' type='password' name='user[password]' placeholder='Password'>\n        </div>\n        <div class='form-group'>\n          <input class='form-control' type='password' name='user[passwordConfirmation]' placeholder='Password Confirmation'>\n        </div>\n        <input class='btn btn-primary' type='submit' value='Register'>\n      </div>\n    </form>"),$(".modal").modal("show")},App.login=function(e){e.preventDefault(),this.$modalContent.html("\n    <form method='post' action='/login'>\n    <div class='modal-header'>\n      <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>\n      <h4 class='modal-title'>Login</h4>\n    </div>\n    <div class='modal-body'>\n      <div class='form-group'>\n      <input class='form-control' type='email' name='email' placeholder='Email'>\n    </div>\n    <div class='form-group'>\n      <input class='form-control' type='password' name='password' placeholder='Password'>\n    </div>\n    <input class='btn btn-primary' type='submit' value='Login'>\n  </form>"),$(".modal").modal("show")},App.logout=function(e){e.preventDefault(),this.removeToken(),this.loggedOutState()},App.handleForm=function(e){e.preventDefault(),$(".modal").modal("hide");var t=""+App.apiUrl+$(this).attr("action"),o=$(this).attr("method"),n=$(this).serialize();return App.ajaxRequest(t,o,n,function(e){e.token&&App.setToken(e.token),App.loggedInState()})},App.ajaxRequest=function(e,t,o,n){return $.ajax({url:e,method:t,data:o,beforeSend:this.setRequestHeader.bind(this)}).done(n).fail(function(e){console.log(e)})},App.setRequestHeader=function(e){return e.setRequestHeader("Authorization","Bearer "+this.getToken())},App.setToken=function(e){return window.localStorage.setItem("token",e)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},App.showSidebar=function(){$(".sidebar").show(),$(".sidebar").html("\n    <button type='button' class='close'\n    aria-label='Close'><span aria-hidden='true'>&times;</span></button>\n    <div class='neighbourhoodOptions'>\n    <p>Where are you?</p>\n    <select class='neighbourhood custom-select mb-2 mr-sm-2 mb-sm-0' id='inlineFormCustomSelect'>\n    <option selected>Neighbourhood...</option>\n    <option value='98130'>Yaletown</option>\n    <option value='98137'>Gastown</option>\n    <option value='98135'>Downtown</option>\n    <option value='98139'>Kitsilano</option>\n    <option value='98129'>Main Street</option>\n    </select>\n    </div>\n    <div class ='mealOptions'>\n    <p>What meal are you looking for?</p>\n    <select class='category custom-select mb-2 mr-sm-2 mb-sm-0' id='inlineFormCustomSelect'>\n    <option selected>Meal...</option>\n    <option value='8'>Breakfast</option>\n    <option value='9'>Lunch</option>\n    <option value='2'>Supper</option>\n    </select>\n    </div>\n    <button type='submit' class='go btn btn-primary'>Go</button>\n    <div class ='usersChoices'>\n    <h3>You have chosen...</h3>\n    <p class='choice1'>CHOICE1</p>\n    <p>for... CATEGORY in LOCATIONNAME</p>\n    </div>\n    </div>\n    ")},App.closeSidebar=function(){$(".sidebar").hide()},App.featuredRestaurant=function(){$(".recommended").show(),$(".recommended").html("\n    <button type='button' class='close' data-dismiss='modal' aria-label='Close'><span aria-hidden='true'>&times;</span></button>\n    <h4>Our picks of the moment:</h4>\n    <p>Downtown:</p>\n    <h6>Cafe Medina</h6>\n    <p>Lavender lattes and belgium waffles</p>\n    <p>Yaletown:</p>\n    <h6>Lupo Restaurant</h6>\n    <p>Delicious Italian in a converted home</p>\n    <p>Kitsilano</p>\n    <h6>Vij's</h6>\n    <p>Best Indian in Vancouver</p>")},App.closeFeatures=function(){$(".recommended").hide()},$(App.init.bind(App));