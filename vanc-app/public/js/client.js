"use strict";var App=App||{};App.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".mapcanvas").on("click",this.mapcanvas.bind(this)),$(".usersIndex").on("click",this.usersIndex.bind(this)),this.$main.on("submit","form",this.handleForm),App.mapcanvas=function(){console.log("test")},this.getToken()?this.loggedInState():this.loggedOutState()},App.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.usersIndex()},App.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show(),this.register()},App.register=function(t){t&&t.preventDefault(),this.$main.html('\n    <h2>Register</h2>\n    <form method="post" action="/register">\n      <div class="form-group">\n        <input class="form-control" type="text" name="user[username]" placeholder="Username">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="email" name="user[email]" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[password]" placeholder="Password">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Register">\n    </form>\n  ')},App.login=function(t){t.preventDefault(),this.$main.html('\n    <h2>Login</h2>\n    <form method="post" action="/login">\n      <div class="form-group">\n        <input class="form-control" type="email" name="email" placeholder="Email">\n      </div>\n      <div class="form-group">\n        <input class="form-control" type="password" name="password" placeholder="Password">\n      </div>\n      <input class="btn btn-primary" type="submit" value="Login">\n    </form>\n  ')},App.logout=function(t){t.preventDefault(),this.removeToken(),this.loggedOutState()},App.usersIndex=function(t){var n=this;t&&t.preventDefault();var e=this.apiUrl+"/users";return this.ajaxRequest(e,"get",null,function(t){n.$main.html('\n      <div class="card-deck-wrapper">\n        <div class="card-deck">\n        </div>\n      </div>\n    ');var e=n.$main.find(".card-deck");$.each(t.users,function(t,n){e.append('\n        <div class="card col-md-4">\n         <img class="card-img-top" src="http://fillmurray.com/300/300" alt="Card image cap">\n         <div class="card-block">\n           <h4 class="card-title">'+n.username+'</h4>\n           <p class="card-text">This is a longer card with supporting text below as a natural lead-in to additional content. This content is a little bit longer.</p>\n           <p class="card-text"><small class="text-muted">Last updated 3 mins ago</small></p>\n         </div>\n       </div>')})})},App.handleForm=function(t){t.preventDefault();var n=""+App.apiUrl+$(this).attr("action"),e=$(this).attr("method"),i=$(this).serialize();return App.ajaxRequest(n,e,i,function(t){t.token&&App.setToken(t.token),App.loggedInState()})},App.ajaxRequest=function(t,n,e,i){return $.ajax({url:t,method:n,data:e,beforeSend:this.setRequestHeader.bind(this)}).done(i).fail(function(t){console.log(t)})},App.setRequestHeader=function(t){return t.setRequestHeader("Authorization","Bearer "+this.getToken())},App.setToken=function(t){return window.localStorage.setItem("token",t)},App.getToken=function(){return window.localStorage.getItem("token")},App.removeToken=function(){return window.localStorage.clear()},$(App.init.bind(App));